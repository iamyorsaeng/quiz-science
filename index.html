<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>แบบทดสอบสัปดาห์วิทยาศาสตร์ + เกียรติบัตร</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: "Noto Sans Thai", sans-serif; background: #f7f7fb; margin: 0; }
    header { background: #e8f0fe; padding: 20px; text-align: center; }
    main { max-width: 900px; margin: auto; padding: 20px; }
    .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .q { margin-bottom: 15px; }
    .q h3 { margin: 0 0 8px; }
    .choices label { display: block; margin-bottom: 5px; }
    button { padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; margin-top: 10px; }
    #submitBtn { background:#28a745; color:white; }
    #resetBtn { background:#ccc; }
    #generateCertBtn { background:#2196F3; color:white; display:none; }
    #retryBtn { display:none; background:#ff9800; color:white; }
    #logoutBtn { display:none; background:#f44336; color:white; }
    .result { margin-top: 10px; padding: 10px; border-radius: 8px; }
    .result.fail { background: #ffe6e6; color: #b00020; }
    .result.pass { background: #e6ffe6; color: #0a7b35; }
    #certificateBox { text-align:center; margin-top:20px; }
    input[type="text"], input[type="email"] { padding: 6px; width: 100%; max-width: 300px; border-radius: 6px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <header>
    <h1>แบบทดสอบสัปดาห์วิทยาศาสตร์</h1>
    <p>ทำแบบทดสอบให้ครบ 20 ข้อ เกณฑ์ผ่าน 80% (16 ข้อ) จะได้รับเกียรติบัตร</p>
  </header>
  <main>
    <form class="card" id="quizForm">
      <div id="questions"></div>
      <button type="button" id="submitBtn">ส่งคำตอบ</button>
      <button type="reset" id="resetBtn">ล้างคำตอบ</button>
      <button type="button" id="retryBtn">ทำแบบทดสอบใหม่</button>
      <button type="button" id="logoutBtn">ออกจากระบบ</button>
      <div id="resultBox" class="result"></div>
    </form>

    <!-- กรอกชื่อเพื่อรับเกียรติบัตร -->
    <div class="card" id="nameSection" style="display:none;">
      <h3>กรอกชื่อเพื่อรับเกียรติบัตร</h3>
      <input type="text" id="studentName" placeholder="ชื่อ–สกุล"><br>
      <button id="generateCertBtn">สร้างเกียรติบัตร</button>
    </div>

    <div id="certificateBox"></div>
  </main>

  <script>
    const bank = [
      { q: "1) วันวิทยาศาสตร์แห่งชาติของประเทศไทยตรงกับวันที่เท่าไรของทุกปี", choices: ["ก. 16 สิงหาคม","ข. 28 สิงหาคม","ค. 18 กันยายน","ง. 18 สิงหาคม"], ans: "ง" },
      { q: "2) ใครได้รับการยกย่องว่าเป็น 'พระบิดาแห่งวิทยาศาสตร์ไทย'", choices: ["ก. รัชกาลที่ 5","ข. สมเด็จพระนารายณ์มหาราช","ค. รัชกาลที่ 6","ง. รัชกาลที่ 4"], ans: "ง" },
      { q: "3) ปรากฏการณ์สุริยุปราคาเต็มดวงที่รัชกาลที่ 4 ทรงคำนวณและทอดพระเนตรเกิดขึ้นที่จังหวัดใด", choices: ["ก. ระยอง","ข. สงขลา","ค. ประจวบคีรีขันธ์","ง. จันทบุรี"], ans: "ค" },
      { q: "4) หน่วยวัดความดันบรรยากาศในระบบ SI คือข้อใด", choices: ["ก. วัตต์","ข. นิวตัน","ค. พาสคัล","ง. จูล"], ans: "ค" },
      { q: "5) อุปกรณ์ใดต่อไปนี้ที่ใช้หลักการแปลงพลังงานจลน์เป็นพลังงานไฟฟ้า", choices: ["ก. แบตเตอรี่","ข. กังหันลม","ค. โซลาร์เซลล์","ง. เครื่องปิ้งขนมปัง"], ans: "ข" },
      { q: "6) โครงสร้างทางชีวภาพที่ทำหน้าที่เป็น 'โรงงานพลังงาน' ของเซลล์คืออะไร", choices: ["ก. คลอโรพลาสต์","ข. แวคิวโอล","ค. นิวเคลียส","ง. ไมโตคอนเดรีย"], ans: "ง" },
      { q: "7) สารประกอบเคมีที่มีสูตร H₂O₂ มีชื่อสามัญว่าอะไร", choices: ["ก. น้ำส้มสายชู","ข. โซเดียมคลอไรด์","ค. ไฮโดรเจนเปอร์ออกไซด์","ง. น้ำ"], ans: "ค" },
      { q: "8) ในระบบสุริยะ ดาวเคราะห์ที่อยู่ใกล้ดวงอาทิตย์มากที่สุดคือ", choices: ["ก. ดาวอังคาร","ข. ดาวพุธ","ค. ดาวศุกร์","ง. โลก"], ans: "ข" },
      { q: "9) ปฏิกิริยาเคมีที่ปล่อยพลังงานออกมาในรูปของความร้อนคือ", choices: ["ก. ดูดความร้อน","ข. การสลายตัว","ค. คายความร้อน","ง. การเผาไหม้"], ans: "ค" },
      { q: "10) การทำสำเนาดีเอ็นเอเกิดขึ้นในระยะใดของวงจรเซลล์", choices: ["ก. ระยะ M","ข. ระยะ S","ค. ระยะ G2","ง. ระยะ G1"], ans: "ข" },
      { q: "11) กฎของนิวตันข้อที่หนึ่งกล่าวถึงเรื่องอะไร", choices: ["ก. ความเฉื่อย","ข. แรงปฏิกิริยา","ค. ความเร่ง","ง. แรงโน้มถ่วง"], ans: "ก" },
      { q: "12) ก๊าซเรือนกระจกหลักที่มีมากที่สุดในบรรยากาศของโลกคือ", choices: ["ก. CO₂","ข. ไอน้ำ","ค. N₂O","ง. CH₄"], ans: "ข" },
      { q: "13) 'Nanotechnology' เกี่ยวข้องกับระดับใด", choices: ["ก. อะตอม/โมเลกุล","ข. มิลลิเมตร","ค. ไมโครเมตร","ง. เซลล์"], ans: "ก" },
      { q: "14) เทคโนโลยีที่ใช้ในการเข้ารหัสข้อมูลบนอินเทอร์เน็ตคือ", choices: ["ก. บล็อกเชน","ข. AI","ค. Data mining","ง. Cryptography"], ans: "ง" },
      { q: "15) เครื่อง MRI ใช้คลื่นแม่เหล็กไฟฟ้าชนิดใด", choices: ["ก. วิทยุ","ข. รังสีแกมมา","ค. ไมโครเวฟ","ง. รังสีเอกซ์"], ans: "ก" },
      { q: "16) ปรากฏการณ์ที่แสงเปลี่ยนทิศทางเมื่อผ่านตัวกลางที่ต่างกันคือ", choices: ["ก. หักเห","ข. เลี้ยวเบน","ค. สะท้อน","ง. แทรกสอด"], ans: "ก" },
      { q: "17) ชิ้นส่วนหลักของคอมพิวเตอร์ที่ประมวลผลคือ", choices: ["ก. HDD","ข. RAM","ค. CPU","ง. Mainboard"], ans: "ค" },
      { q: "18) แรงโน้มถ่วงระหว่างวัตถุสองก้อนขึ้นกับ", choices: ["ก. ความเร็ว","ข. มวลและระยะห่าง","ค. รูปร่าง","ง. ปริมาตร"], ans: "ข" },
      { q: "19) ส่วนประกอบของเซลล์พืชที่สังเคราะห์ด้วยแสงคือ", choices: ["ก. ผนังเซลล์","ข. ไซโทพลาสซึม","ค. คลอโรพลาสต์","ง. นิวเคลียส"], ans: "ค" },
      { q: "20) อุปกรณ์ใดที่ไม่ได้ใช้คลื่นเสียงในการทำงาน", choices: ["ก. Metal detector","ข. Radar","ค. Sonar","ง. Ultrasound"], ans: "ข" }
    ];

    const qWrap = document.getElementById("questions");
    bank.forEach((item, idx) => {
      const qEl = document.createElement("div");
      qEl.className = "q";
      const name = `q${idx+1}`;
      const letters = ["ก","ข","ค","ง"];
      qEl.innerHTML = `<h3>${item.q}</h3>
        <div class="choices">
          ${item.choices.map((c,i)=>`<label><input type="radio" name="${name}" value="${letters[i]}"> ${c}</label>`).join("")}
        </div>`;
      qWrap.appendChild(qEl);
    });

    const submitBtn = document.getElementById("submitBtn");
    const resetBtn = document.getElementById("resetBtn");
    const resultBox = document.getElementById("resultBox");
    const retryBtn = document.getElementById("retryBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const nameSection = document.getElementById("nameSection");
    const generateCertBtn = document.getElementById("generateCertBtn");
    const certificateBox = document.getElementById("certificateBox");
    const PASS_PERCENT = 80;

    submitBtn.addEventListener("click", () => {
      let correct = 0;
      bank.forEach((item, idx) => {
        const chosen = (document.querySelector(`input[name=q${idx+1}]:checked`)||{}).value;
        if (chosen === item.ans) correct++;
      });

      const percent = Math.round((correct/bank.length)*100);
      if (percent >= PASS_PERCENT) {
        resultBox.className="result pass";
        resultBox.innerHTML=`ผ่าน! ได้ ${correct}/${bank.length} (${percent}%)`;
        nameSection.style.display = "block";
      } else {
        resultBox.className="result fail";
        resultBox.innerHTML=`ไม่ผ่าน ได้ ${correct}/${bank.length} (${percent}%)`;
      }

      retryBtn.style.display="inline-block";
      logoutBtn.style.display="inline-block";
    });

    generateCertBtn.addEventListener("click", () => {
      const name = (document.getElementById("studentName").value || "").trim();
      if(!name) return alert("กรุณากรอกชื่อ–สกุล");

      const canvas = document.createElement("canvas");
      canvas.width = 1200;
      canvas.height = 850;
      const ctx = canvas.getContext("2d");

      const img = new Image();
      img.src = "certificate_bg.png"; // ต้องมีไฟล์นี้ใน repo
      img.onload = function() {
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        // ชื่อผู้เรียน
        ctx.font = "bold 48px sans-serif";
        ctx.fillStyle = "#ffffff";
        ctx.textAlign = "center";
        ctx.fillText(name, canvas.width/2, 420);

        certificateBox.innerHTML = "";
        certificateBox.appendChild(canvas);

        // ปุ่มดาวน์โหลด
        const downloadBtn = document.createElement("button");
        downloadBtn.innerText = "ดาวน์โหลดเกียรติบัตร";
        downloadBtn.style.marginTop = "10px";
        downloadBtn.onclick = () => {
          const link = document.createElement("a");
          link.download = "certificate.png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        };
        certificateBox.appendChild(downloadBtn);
      };
    });

    resetBtn.addEventListener("click", ()=>{ 
      resultBox.innerHTML=""; 
      retryBtn.style.display="none";
      logoutBtn.style.display="none";
      nameSection.style.display="none";
      certificateBox.innerHTML = "";
    });

    retryBtn.addEventListener("click", () => {
      document.getElementById("quizForm").reset();
      resultBox.innerHTML = "";
      retryBtn.style.display = "none";
      logoutBtn.style.display = "none";
      nameSection.style.display="none";
      certificateBox.innerHTML = "";
    });

    logoutBtn.addEventListener("click", () => {
      window.location.reload();
    });
  </script>
</body>
</html>
